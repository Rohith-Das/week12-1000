<%- include("../adminLayout/header")%>

  
  <!-- ?PROD Only: Google Tag Manager (noscript) (Default ThemeSelection: GTM-5DDHKGP, PixInvent: GTM-5J3LMKC) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DDHKGP" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar  ">
  <div class="layout-container">

    
    




<!-- Menu -->
 
<!-- Menu -->


<aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">

  
  <div class="app-brand demo ">
    <a href="index.html" class="app-brand-link">
      <span class="app-brand-logo demo me-1">
<span style="color:var(--bs-primary);">
  <svg width="30" height="24" viewBox="0 0 250 196" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.3002 1.25469L56.655 28.6432C59.0349 30.1128 60.4839 32.711 60.4839 35.5089V160.63C60.4839 163.468 58.9941 166.097 56.5603 167.553L12.2055 194.107C8.3836 196.395 3.43136 195.15 1.14435 191.327C0.395485 190.075 0 188.643 0 187.184V8.12039C0 3.66447 3.61061 0.0522461 8.06452 0.0522461C9.56056 0.0522461 11.0271 0.468577 12.3002 1.25469Z" fill="currentColor" />
    <path opacity="0.077704" fill-rule="evenodd" clip-rule="evenodd" d="M0 65.2656L60.4839 99.9629V133.979L0 65.2656Z" fill="black" />
    <path opacity="0.077704" fill-rule="evenodd" clip-rule="evenodd" d="M0 65.2656L60.4839 99.0795V119.859L0 65.2656Z" fill="black" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M237.71 1.22393L193.355 28.5207C190.97 29.9889 189.516 32.5905 189.516 35.3927V160.631C189.516 163.469 191.006 166.098 193.44 167.555L237.794 194.108C241.616 196.396 246.569 195.151 248.856 191.328C249.605 190.076 250 188.644 250 187.185V8.09597C250 3.64006 246.389 0.027832 241.935 0.027832C240.444 0.027832 238.981 0.441882 237.71 1.22393Z" fill="currentColor" />
    <path opacity="0.077704" fill-rule="evenodd" clip-rule="evenodd" d="M250 65.2656L189.516 99.8897V135.006L250 65.2656Z" fill="black" />
    <path opacity="0.077704" fill-rule="evenodd" clip-rule="evenodd" d="M250 65.2656L189.516 99.0497V120.886L250 65.2656Z" fill="black" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z" fill="currentColor" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z" fill="white" fill-opacity="0.15" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z" fill="currentColor" />
    <path fill-rule="evenodd" clip-rule="evenodd" d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z" fill="white" fill-opacity="0.3" />
  </svg>
</span>
</span>
      <span class="app-brand-text demo menu-text fw-semibold ms-2">Materio</span>
    </a>

    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
      <i class="menu-toggle-icon d-xl-block align-middle"></i>
    </a>
  </div>

  <div class="menu-inner-shadow"></div>

  
  
  <ul class="menu-inner py-1">
    
    <!-- e-commerce-app menu start -->
    <li class="menu-item active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle">
        <i class='menu-icon tf-icons ri-shopping-bag-3-line'></i>
        <div data-i18n="eCommerce">eCommerce</div>
      </a>
      <ul class="menu-sub">
        <!-- <li class="menu-item">
          <a href="/admin/dash" class="menu-link">
            <div data-i18n="dashboard">dashboard</div>
          </a>
        </li> -->
        <li class="menu-item active">
          <a href="/admin/dashboard" class="menu-link">
            <div data-i18n="Dashboard">Dashboard</div>
          </a>
        </li>
        <li class="menu-item">
          <a href="javascript:void(0);" class="menu-link menu-toggle">
            <div data-i18n="Products">Products</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="/admin/dashboard/productList" class="menu-link">
                <div data-i18n="Product List">Product List</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="/admin/dashboard/addProduct" class="menu-link">
                <div data-i18n="Add Product">Add Product</div>
              </a>
            </li>
           
          </ul>
        </li>


        <li class="menu-item">
          <a href="/admin/dashboard/categoryList" class="menu-link">
            <div data-i18n="Category List">Category List</div>
          </a>
        </li>
        
        <li class="menu-item">
          <a href="/admin/dashboard/brandList" class="menu-link">
            <div data-i18n="Brands">Brands</div>
          </a>
        </li>


        <li class="menu-item">
          <a href="/admin/dashboard/brandList;" class="menu-link menu-toggle">
            <div data-i18n="Order">Order</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="/admin/dashboard/orderList" class="menu-link">
                <div data-i18n="Order List">Order List</div>
              </a>
            </li>
            <!-- <li class="menu-item">
              <a href="app-ecommerce-order-details.html" class="menu-link">
                <div data-i18n="Order Details">Order Details</div>
              </a>
            </li> -->
          </ul>
        </li>
        <li class="menu-item">
          <a href="/admin/dashboard/allcustomer" class="menu-link menu-toggle">
            <div data-i18n="Customer">Customer</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item ">
              <a href="/admin/dashboard/allcustomer" class="menu-link">
                <div data-i18n="All Customers">All Customers</div>
              </a>
            </li>
          
          </ul>
        </li>
        <li class="menu-item">
          <a href="/admin/dashboard/offers" class="menu-link menu-toggle">
            <div data-i18n="offer">offer</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="/admin/dashboard/offers/create" class="menu-link">
                <div data-i18n="Add offer">Add offer</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="/admin/dashboard/offers" class="menu-link">
                <div data-i18n="List offer">List offer</div>
              </a>
            </li>
           
          </ul>
        </li>


        <li class="menu-item">
          <a href="/admin/dashboard/coupons" class="menu-link menu-toggle">
            <div data-i18n="coupons">coupons</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="/admin/dashboard/coupons" class="menu-link">
                <div data-i18n="coupon list">coupon list</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="/admin/dashboard/coupons/create" class="menu-link">
                <div data-i18n="add coupon">add coupon</div>
              </a>
            </li>
           
          </ul>
        </li>
       
          </ul>
        </li>
      </ul>
    </li>
    <!-- e-commerce-app menu end -->
    <!-- Academy menu start -->
   

    <!-- Components -->
    <li class="menu-header mt-7">
      <form action="/login" method="POST">
        <button type="submit">Logout</button>
    </form>
    </li>
    <!-- Cards -->
    <!-- User interface -->
   
   
  
  

</aside>
<!-- / Menu -->

    

    <!-- Layout container -->
    <div class="layout-page">
      
      



<!-- Navbar -->

<nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
  
      <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0   d-xl-none ">
        <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
          <i class="ri-menu-fill ri-24px"></i>
        </a>
      </div>

      <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
  
        <ul class="navbar-nav flex-row align-items-center ms-auto">

          
          
         
      

         

        </ul>
      </div>

      
      <!-- Search Small Screens -->
      <div class="navbar-search-wrapper search-input-wrapper  d-none">
        <input type="text" class="form-control search-input container-xxl border-0" placeholder="Search..." aria-label="Search...">
        <i class="ri-close-fill search-toggler cursor-pointer"></i>
      </div>
      
      
  
</nav>

<!-- / Navbar -->
      <!-- Content wrapper -->
      <div class="content-wrapper">
        <!-- Content -->
          <div class="container-xxl flex-grow-1 container-p-y">
            <title>sales Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold mb-8 text-gray-800">Sales Report</h1>
        
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 transition duration-300 ease-in-out transform hover:scale-105">
                <h2 class="text-xl font-semibold mb-2 text-gray-700">Total Sales</h2>
                <p id="totalSales" class="text-3xl font-bold text-green-600">₹<%= overallOrderAmount.toLocaleString() %></p>
                <i class="fas fa-chart-line text-4xl text-green-400 float-right -mt-8"></i>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 transition duration-300 ease-in-out transform hover:scale-105">
                <h2 class="text-xl font-semibold mb-2 text-gray-700">Orders</h2>
                <p id="totalOrders" class="text-3xl font-bold text-blue-600"><%= overallSalesCount %></p>
                <i class="fas fa-shopping-cart text-4xl text-blue-400 float-right -mt-8"></i>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 transition duration-300 ease-in-out transform hover:scale-105">
                <h2 class="text-xl font-semibold mb-2 text-gray-700">Total Discount</h2>
                <p id="totalDiscount" class="text-3xl font-bold text-purple-600">₹<%= overallDiscount.toLocaleString() %></p>
                <i class="fas fa-tags text-4xl text-purple-400 float-right -mt-8"></i>
            </div>
        </div>
        <!-- top 10 -->
         


        
        <!-- Sales Chart -->
       <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Sales Chart</h2>
    <canvas id="salesChart" width="300" height="100"></canvas> 
</div>

        
        <!-- Sales Report -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Sales Report</h2>

           
                  
            
            <!-- Filter Form -->
            <form id="filterForm" class="mb-6">
              <div class="flex flex-wrap gap-4 items-end">
                  <div>
                      <label for="filter" class="block text-sm font-medium text-gray-700 mb-1">Filter</label>
                      <select name="filter" id="filter" class="border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="toggleDateInputs()">
                          <option value="daily" <%= filter === 'daily' ? 'selected' : '' %>>Today</option>
                          <option value="weekly" <%= filter === 'weekly' ? 'selected' : '' %>>This Week</option>
                          <option value="monthly" <%= filter === 'monthly' ? 'selected' : '' %>>This Month</option>
                          <option value="yearly" <%= filter === 'yearly' ? 'selected' : '' %>>This Year</option>
                          <option value="custom" <%= filter === 'custom' ? 'selected' : '' %>>Custom</option>
                          <option value="date-range" <%= filter === 'date-range' ? 'selected' : '' %>>Date Range</option>
                      </select>
                  </div>
                  <div id="dateInputs" style="display: <%= ['custom', 'date-range'].includes(filter) ? 'flex' : 'none' %>;" class="gap-4">
                      <div>
                          <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                          <input type="date" name="startDate" id="startDate" value="<%= startDate %>" class="border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                          <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                          <input type="date" name="endDate" id="endDate" value="<%= endDate %>" class="border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                  </div>
                  <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500">
                      <i class="fas fa-filter mr-2"></i>Filter
                  </button>
              </div>
          </form>


            <div class="flex space-x-4 mb-6">
              <button id="downloadPDF" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500">
                  <i class="fas fa-file-pdf mr-2"></i>Download PDF
              </button>
              <button id="downloadExcel" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500">
                  <i class="fas fa-file-excel mr-2"></i>Download Excel
              </button>
          </div>

            
            <!-- Sales Table -->
            <div class="overflow-x-auto bg-white rounded-lg shadow">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-200 text-gray-700">
                            <th class="px-4 py-2">Order Date</th>
                            <th class="px-4 py-2">Order ID</th>
                            <th class="px-4 py-2">Customer Name</th>
                            <th class="px-4 py-2">Payment Method</th>
                            <th class="px-4 py-2">Coupon Code</th>
                            <th class="px-4 py-2">Order Status</th>
                            <th class="px-4 py-2">Discount</th>
                            <th class="px-4 py-2">Item Quantity</th>
                            <th class="px-4 py-2">Total Amount</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <% orders.forEach(order => { %>
                            <tr class="border-b hover:bg-gray-100">
                                <td class="px-4 py-2"><%= order.orderDate %></td>
                                <td class="px-4 py-2"><%= order.orderId %></td>
                                <td class="px-4 py-2"><%= order.customerName ? order.customerName : 'No Name' %></td>

                                <td class="px-4 py-2"><%= order.paymentMethod %></td>
                                <td class="px-4 py-2"><%= order.couponCode %></td>
                                <td class="px-4 py-2">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                        <%= order.orderStatus === 'Completed' ? 'bg-green-100 text-green-800' : 
                                           order.orderStatus === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 
                                           'bg-red-100 text-red-800' %>">
                                        <%= order.orderStatus %>
                                    </span>
                                </td>
                                <td class="px-4 py-2">₹<%= order.discount.toLocaleString() %></td>
                                <td class="px-4 py-2"><%= order.itemQuantity %></td>
                                <td class="px-4 py-2">₹<%= order.totalAmount.toLocaleString() %></td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div class="mt-6 flex justify-between items-center">
                <div class="text-sm text-gray-700">
                    Showing <span id="startIndex" class="font-medium">1</span> to <span id="endIndex" class="font-medium">10</span> of <span id="totalOrders" class="font-medium"><%= pagination.totalOrders %></span> orders
                </div>
                <div class="flex space-x-2">
                    <button id="prevPage" class="px-4 py-2 border rounded-md <%= pagination.hasPrevPage ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500' %> transition duration-300 ease-in-out transform hover:scale-105" <%= !pagination.hasPrevPage ? 'disabled' : '' %>>
                        <i class="fas fa-chevron-left mr-2"></i>Previous
                    </button>
                    <span id="currentPage" class="px-4 py-2 border rounded-md bg-gray-100"><%= pagination.currentPage %></span>
                    <button id="nextPage" class="px-4 py-2 border rounded-md <%= pagination.hasNextPage ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500' %> transition duration-300 ease-in-out transform hover:scale-105" <%= !pagination.hasNextPage ? 'disabled' : '' %>>
                        Next<i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="table-container">
      <h2 class="toggle-header" id="toggle-products">
          Top 10 Selling Products 
          <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <table id="products-table" class="fade-in table-style">
          <thead>
              <tr>
                  <th>Product Name</th>
                  <th>Total Sold</th>
              </tr>
          </thead>
          <tbody>
              <% topSellingProducts.forEach(product => { %>
                  <tr>
                      <td><%= product.productName %></td>
                      <td><%= product.totalSold %></td>
                  </tr>
              <% }) %>
          </tbody>
      </table>
  </div>
  
  <div class="table-container">
      <h2 class="toggle-header" id="toggle-brands">
          Top 10 Selling Brands 
          <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <table id="brands-table" class="fade-in table-style">
          <thead>
              <tr>
                  <th>Brand Name</th>
                  <th>Total Sold</th>
              </tr>
          </thead>
          <tbody>
              <% topSellingBrands.forEach(brand => { %>
                  <tr>
                      <td><%= brand.brandName %></td>
                      <td><%= brand.totalSold %></td>
                  </tr>
              <% }) %>
          </tbody>
      </table>
  </div>
  
  <div class="table-container">
      <h2 class="toggle-header" id="toggle-categories">
          Top 10 Selling Categories 
          <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <table id="categories-table" class="fade-in table-style">
          <thead>
              <tr>
                  <th>Category Name</th>
                  <th>Total Sold</th>
              </tr>
          </thead>
          <tbody>
              <% topSellingCategories.forEach(category => { %>
                  <tr>
                      <td><%= category.categoryName %></td>
                      <td><%= category.totalSold %></td>
                  </tr>
              <% }) %>
          </tbody>
      </table>
  </div>
  
  <!-- JavaScript -->
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const toggleProducts = document.getElementById('toggle-products');
          const productsTable = document.getElementById('products-table');
  
          const toggleBrands = document.getElementById('toggle-brands');
          const brandsTable = document.getElementById('brands-table');
  
          const toggleCategories = document.getElementById('toggle-categories');
          const categoriesTable = document.getElementById('categories-table');
  
          toggleProducts.addEventListener('click', function() {
              toggleTable(productsTable, toggleProducts);
          });
  
          toggleBrands.addEventListener('click', function() {
              toggleTable(brandsTable, toggleBrands);
          });
  
          toggleCategories.addEventListener('click', function() {
              toggleTable(categoriesTable, toggleCategories);
          });
  
          function toggleTable(table, toggleElement) {
              table.classList.toggle('active');
              const icon = toggleElement.querySelector('.toggle-icon');
              icon.classList.toggle('fa-chevron-down');
              icon.classList.toggle('fa-chevron-up');
          }
      });
  </script>
  
  <!-- CSS -->
  <style>
      .table-container {
          margin-bottom: 20px;
          padding: 20px;
          background-color: #f9f9f9;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
  
      .toggle-header {
          cursor: pointer;
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 20px;
          color: #333;
          padding-bottom: 10px;
          border-bottom: 2px solid #ddd;
      }
  
      .toggle-header:hover {
          color: #0056b3;
      }
  
      .toggle-icon {
          transition: transform 0.3s ease;
      }
  
      .table-style {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
          overflow: hidden;
      }
  
      .table-style th,
      .table-style td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid #ddd;
      }
  
      .table-style th {
          background-color: #f1f1f1;
          color: #333;
      }
  
      .table-style td {
          background-color: #fff;
          color: #666;
      }
  
      .table-style tr:hover {
          background-color: #f5f5f5;
      }
  
      .fade-in {
          opacity: 0;
          transition: opacity 0.5s ease;
          display: none;
      }
  
      .fade-in.active {
          opacity: 1;
          display: table;
      }
  </style>
  
        
            <script>
                let salesChart;
        
                // Function to toggle date inputs
                function toggleDateInputs() {
                    const filter = document.getElementById('filter').value;
                    const dateInputs = document.getElementById('dateInputs');
                    if (filter === 'custom' || filter === 'date-range') {
                        dateInputs.style.display = 'flex';
                    } else {
                        dateInputs.style.display = 'none';
                    }
                }
        
                // Function to update the chart
                function updateChart(orders) {
                    const ctx = document.getElementById('salesChart').getContext('2d');
                    
                    if (salesChart) {
                        salesChart.destroy();
                    }
        
                    salesChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: orders.map(order => order.orderDate),
                            datasets: [{
                                label: 'Total Amount',
                                data: orders.map(order => order.totalAmount),
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }, {
                                label: 'Discount',
                                data: orders.map(order => order.discount),
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
        
                // Function to update the table
                function updateTable(orders) {
                    const tableBody = document.getElementById('orderTableBody');
                    tableBody.innerHTML = '';
                    orders.forEach(order => {
                        tableBody.innerHTML += `
                            <tr class="border-b">
                                <td class="px-4 py-2">${order.orderDate}</td>
                                <td class="px-4 py-2">${order.orderId}</td>
                                <td class="px-4 py-2">${order.customerName}</td>
                                <td class="px-4 py-2">${order.paymentMethod}</td>
                                <td class="px-4 py-2">${order.couponCode}</td>
                                <td class="px-4 py-2">${order.orderStatus}</td>
                                <td class="px-4 py-2">₹${order.discount.toLocaleString()}</td>
                                <td class="px-4 py-2">${order.itemQuantity}</td>
                                <td class="px-4 py-2">₹${order.totalAmount.toLocaleString()}</td>
                            </tr>
                        `;
                    });
                }
        
                // Function to update summary cards
                function updateSummaryCards(data) {
    document.getElementById('totalSales').textContent = `₹${data.overallOrderAmount.toLocaleString()}`;
    document.getElementById('totalOrders').textContent = data.overallSalesCount;
    document.getElementById('totalDiscount').textContent = `₹${data.overallDiscount.toLocaleString()}`;
}

// Function to handle form submission
document.getElementById('filterForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const searchParams = new URLSearchParams(formData);

    fetch(`/admin/dashboard?${searchParams.toString()}`, {
        method: 'GET',
        headers: {
            'Accept': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        updateSummaryCards(data);
        updateChart(data.orders);
        updateTable(data.orders);
        updatePaginationControls(data.pagination);
    })
    .catch(error => console.error('Error:', error));
});

function updateSummaryCards(data) {
    document.getElementById('totalSales').textContent = `₹${data.overallOrderAmount.toLocaleString()}`;
    document.getElementById('totalOrders').textContent = data.overallSalesCount;
    document.getElementById('totalDiscount').textContent = `₹${data.overallDiscount.toLocaleString()}`;
}
// Function to fetch data
function fetchData(page = 1) {
    const formData = new FormData(document.getElementById('filterForm'));
    formData.append('page', page);
    const searchParams = new URLSearchParams(formData);

    fetch(`/admin/dashboard?${searchParams.toString()}`, {
        method: 'GET',
        headers: {
            'Accept': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        updateSummaryCards(data);
        updateChart(data.orders);
        updateTable(data.orders);
        updatePaginationControls(data.pagination);
        currentPage = data.pagination.currentPage;
        totalPages = data.pagination.totalPages;
    })
    .catch(error => console.error('Error:', error));
}

// Initial chart setup and data fetch
fetchData(1);
        
                // Initial chart setup
                // updateChart(<%- JSON.stringify(orders) %>);

                function updatePaginationControls(pagination) {
        const { currentPage, totalPages, hasNextPage, hasPrevPage, totalOrders } = pagination;
        document.getElementById('currentPage').textContent = currentPage;
        document.getElementById('prevPage').disabled = !hasPrevPage;
        document.getElementById('nextPage').disabled = !hasNextPage;
        document.getElementById('totalOrders').textContent = totalOrders;
        
        const startIndex = (currentPage - 1) * 10 + 1;
        const endIndex = Math.min(currentPage * 10, totalOrders);
        document.getElementById('startIndex').textContent = startIndex;
        document.getElementById('endIndex').textContent = endIndex;

        document.getElementById('prevPage').classList.toggle('bg-blue-500', hasPrevPage);
        document.getElementById('prevPage').classList.toggle('text-white', hasPrevPage);
        document.getElementById('prevPage').classList.toggle('bg-gray-200', !hasPrevPage);
        document.getElementById('prevPage').classList.toggle('text-gray-500', !hasPrevPage);

        document.getElementById('nextPage').classList.toggle('bg-blue-500', hasNextPage);
        document.getElementById('nextPage').classList.toggle('text-white', hasNextPage);
        document.getElementById('nextPage').classList.toggle('bg-gray-200', !hasNextPage);
        document.getElementById('nextPage').classList.toggle('text-gray-500', !hasNextPage);
    }

    // Function to fetch data
    function fetchData(page = 1) {
        const formData = new FormData(document.getElementById('filterForm'));
        formData.append('page', page);
        const searchParams = new URLSearchParams(formData);

        fetch(`/admin/dashboard?${searchParams.toString()}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            updateSummaryCards(data);
            updateChart(data.orders);
            updateTable(data.orders);
            updatePaginationControls(data.pagination);
            currentPage = data.pagination.currentPage;
            totalPages = data.pagination.totalPages;
        })
        .catch(error => console.error('Error:', error));
    }

    // Event listener for form submission
    document.getElementById('filterForm').addEventListener('submit', function(e) {
        e.preventDefault();
        currentPage = 1;
        fetchData(currentPage);
    });

    // Event listeners for pagination buttons
    document.getElementById('prevPage').addEventListener('click', function() {
        if (currentPage > 1) {
            fetchData(currentPage - 1);
        }
    });

    document.getElementById('nextPage').addEventListener('click', function() {
        if (currentPage < totalPages) {
            fetchData(currentPage + 1);
        }
    });

    // Initial chart setup
    updateChart(<%- JSON.stringify(orders) %>);
    updatePaginationControls(<%- JSON.stringify(pagination) %>);


    
document.getElementById('downloadPDF').addEventListener('click', function() {
        downloadReport('pdf');
    });

    document.getElementById('downloadExcel').addEventListener('click', function() {
        downloadReport('excel');
    });

    function downloadReport(format) {
    const formData = new FormData(document.getElementById('filterForm'));
    formData.append('format', format);
    const searchParams = new URLSearchParams(formData);

    // Show loading indicator
    const loadingIndicator = document.createElement('div');
    loadingIndicator.textContent = 'Generating report...';
    loadingIndicator.style.position = 'fixed';
    loadingIndicator.style.top = '50%';
    loadingIndicator.style.left = '50%';
    loadingIndicator.style.transform = 'translate(-50%, -50%)';
    loadingIndicator.style.padding = '20px';
    loadingIndicator.style.background = 'rgba(0,0,0,0.7)';
    loadingIndicator.style.color = 'white';
    loadingIndicator.style.borderRadius = '10px';
    document.body.appendChild(loadingIndicator);

    // Update the URL to match your route
    fetch(`/admin/download-report?${searchParams.toString()}`, {
        method: 'GET',
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.blob();
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = `sales_report.${format === 'pdf' ? 'pdf' : 'xlsx'}`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
    })
    .catch(error => {
        console.error('Error:', error);
        alert(`Failed to download report: ${error.message}`);
    })
    .finally(() => {
        // Remove loading indicator
        document.body.removeChild(loadingIndicator);
    });
}
            </script>
            <!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Get today's date in YYYY-MM-DD format
      const today = new Date().toISOString().split('T')[0];

      // Get startDate and endDate inputs
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');

      // Set max attribute to today to prevent future dates
      startDateInput.setAttribute('max', today);
      endDateInput.setAttribute('max', today);

      // Form submission validation
      document.getElementById('filterForm').addEventListener('submit', function(event) {
          const startDate = new Date(startDateInput.value);
          const endDate = new Date(endDateInput.value);
          const currentDate = new Date(today);

          // Check if startDate or endDate is in the future
          if (startDate > currentDate || endDate > currentDate) {
              Swal.fire({
                  icon: 'error',
                  title: 'Invalid Date Selection',
                  text: 'Start Date or End Date cannot be in the future!',
                  confirmButtonText: 'OK'
              });
              event.preventDefault(); // Prevent form submission
              return;
          }

          // Check if startDate is later than endDate
          if (startDate > endDate) {
              Swal.fire({
                  icon: 'error',
                  title: 'Invalid Date Range',
                  text: 'End Date cannot be earlier than Start Date!',
                  confirmButtonText: 'OK'
              });
              event.preventDefault(); // Prevent form submission
              return;
          }
      });
  });

  // Show or hide the date inputs based on the filter selection
  function toggleDateInputs() {
      const filter = document.getElementById('filter').value;
      const dateInputs = document.getElementById('dateInputs');

      if (filter === 'custom' || filter === 'date-range') {
          dateInputs.style.display = 'flex';
      } else {
          dateInputs.style.display = 'none';
      }
  }
</script>

          <!-- / Content -->

          
          

<!-- Footer -->
<footer class="content-footer footer bg-footer-theme">
  <div class="container-xxl">
    <div class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
      <div class="text-body mb-2 mb-md-0">
        © <script>
        document.write(new Date().getFullYear())

        </script>, made with <span class="text-danger"><i class="tf-icons ri-heart-fill"></i></span> by <a href="https://themeselection.com/" target="_blank" class="footer-link">ThemeSelection</a>
      </div>
      <div class="d-none d-lg-inline-block">
        
        <a href="https://themeselection.com/license/" class="footer-link me-4" target="_blank">License</a>
        <a href="https://themeselection.com/" target="_blank" class="footer-link me-4">More Themes</a>
        
        <a href="https://demos.themeselection.com/materio-bootstrap-html-admin-template/documentation/" target="_blank" class="footer-link me-4">Documentation</a>
        
        
        <a href="https://themeselection.com/support/" target="_blank" class="footer-link d-none d-sm-inline-block">Support</a>
        
      </div>
    </div>
  </div>
</footer>
<!-- / Footer -->

          
          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    
    
    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    
    
    <!-- Drag Target Area To SlideIn Menu On Small Screens -->
    <div class="drag-target"></div>
    
  </div>
  <!-- / Layout wrapper -->

  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="/dashboard-assets/vendor/libs/jquery/jquery.js"></script>
  <script src="/dashboard-assets/vendor/libs/popper/popper.js"></script>
  <script src="/dashboard-assets/vendor/js/bootstrap.js"></script>
  <script src="/dashboard-assets/vendor/libs/node-waves/node-waves.js"></script>
  <script src="/dashboard-assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="/dashboard-assets/vendor/libs/hammer/hammer.js"></script>
  <script src="/dashboard-assets/vendor/libs/i18n/i18n.js"></script>
  <script src="/dashboard-assets/vendor/libs/typeahead-js/typeahead.js"></script>
  <script src="/dashboard-assets/vendor/js/menu.js"></script>
  
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="/dashboard-assets/vendor/libs/apex-charts/apexcharts.js"></script>

  <!-- Main JS -->
  <script src="/dashboard-assets/js/main.js"></script>
  

  <!-- Page JS -->
  <!-- <script src="/dashboard-assets/js/app-ecommerce-dashboard.js"></script> -->
  
</body>


<!-- Mirrored from demos.themeselection.com/materio-bootstrap-html-admin-template/html/vertical-menu-template/app-ecommerce-dashboard.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 25 Jun 2024 05:47:59 GMT -->
</html>

<!-- beautify ignore:end -->

